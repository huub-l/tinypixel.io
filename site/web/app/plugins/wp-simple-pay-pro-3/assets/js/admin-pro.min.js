/*! WP Simple Pay Pro 3 - 3.2.3
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var spAdminPro={};!function(l){"use strict";var d,m;spAdminPro={init:function(){d=l(document.body),m=d.find("#simpay-form-settings"),this.loadCustomFieldMetaboxes(),this.addDatepicker(),d.on("DOMNodeInserted.simpayDOMNodeInserted",".simpay-custom-fields",this.disableSubscriptions),d.on("DOMNodeRemoved.simpayDOMNodeRemoved",".simpay-custom-fields",this.enableSubscriptions),this.initSortableFields(m.find(".simpay-custom-fields")),m.find(".add-field").on("click.simpayAddField",this.addField),m.find(".simpay-custom-fields").on("click.simpayRemoveField",".simpay-remove-field-link",spAdminPro.removeField),m.find(".simpay-metaboxes-wrapper").on("click.simpayToggleMetabox",".simpay-metabox h3",function(e){spAdminPro.initMetaboxToggle(l(this),e)}),m.on("change.simpayToggleAmountOptions",'.simpay-disable-amount input[type="radio"], .simpay-dropdown-amount, .simpay-radio-amount',function(){spAdminPro.toggleAmountOptions(l(this))}),l(".simpay-tax-percent-field").on("blur.simpayTaxPercentBlur",function(){spAdminPro.handleTaxPercent(l(this))}),0<m.find(".simpay-custom-field-recurring-amount-toggle").length&&m.find('#_subscription_type input[type="radio"]').attr("disabled","disabled")},handleTaxPercent:function(e){e.val(parseFloat(e.val()).toFixed(4))},disableSubscriptions:function(e){var i=e.target,t=m.find('#_subscription_type input[type="radio"]');l(i).hasClass("simpay-custom-field-recurring-amount-toggle")&&(m.find("#_subscription_type-disabled").click(),t.attr("disabled","disabled"))},enableSubscriptions:function(e){var i=e.target,t=m.find('#_subscription_type input[type="radio"]');l(i).hasClass("simpay-custom-field-recurring-amount-toggle")&&t.removeAttr("disabled")},initSortableFields:function(e){e.sortable({items:".simpay-field-metabox",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"simpay-metabox-sortable-placeholder",start:function(e,i){i.item.css("background-color","#f6f6f6")},stop:function(e,i){i.item.removeAttr("style"),spAdminPro.orderFields()}})},addField:function(e){var t,i,a=m.find(".simpay-custom-fields .simpay-field-metabox").length,s=a,o=l(this).closest("#simpay-custom-fields-wrap").find(".simpay-metaboxes"),n=parseInt(m.find("#custom-field-select option:selected").data("counter"))+1,d=m.find("#custom-field-select").val();o.find(".simpay-field-metabox").each(function(){(l(this).hasClass("simpay-custom-field-payment-button")||l(this).hasClass("simpay-custom-field-custom-amount")||l(this).hasClass("simpay-custom-field-plan-select")||l(this).hasClass("simpay-custom-field-total-amount"))&&s--}),i={action:"simpay_add_field",fieldType:d,counter:n,addFieldNonce:m.find("#simpay_custom_fields_nonce").val()},e.preventDefault(),"payment_button"===d&&0<m.find(".simpay-custom-field-payment-button").length?alert(spGeneral.i18n.limitPaymentButtonField):"custom_amount"===d&&0<m.find(".simpay-custom-field-custom-amount").length?alert(spGeneral.i18n.limitCustomAmountField):"plan_select"===d&&0<m.find(".simpay-custom-field-plan-select").length?alert(spGeneral.i18n.limitPlanSelectField):"coupon"===d&&0<m.find(".simpay-custom-field-coupon").length?alert(spGeneral.i18n.limitCouponField):"recurring_amount_toggle"===d&&0<m.find(".simpay-custom-field-recurring-amount-toggle").length?alert(spGeneral.i18n.limitRecurringAmountToggleField):20<=s&&-1===l.inArray(d,["total_amount","payment_button","custom_amount","plan_select"])?alert(spGeneral.i18n.limitMaxFields):(m.find(".simpay-field-data").each(function(){l(this).is(":visible")&&(l(this).hide(),l(this).addClass("closed"))}),l.ajax({url:ajaxurl,method:"POST",data:i,success:function(e){var i=l("<div/>").append(e);i.find(".field-order").val(a),i.find("input").each(function(){void 0!==(t=l(this).attr("id"))&&l(this).attr("id",t.replace(/(\d+)/,parseInt(n)))}),spAdminPro.orderFields(),o.append(i.html()),"date"===d&&spAdminPro.addDatepicker()},error:function(e){spShared.debugLog(e)}}),m.find(".simpay-field-select option").data("counter",n))},removeField:function(e){e.preventDefault(),window.confirm("Are you sure you want to remove this field?")&&l(this).closest(".simpay-field-metabox").remove()},orderFields:function(){l(".simpay-custom-fields .simpay-field-metabox").each(function(e,i){var t=parseInt(l(i).index(".simpay-custom-fields .simpay-field-metabox"));l(".field-order",i).val(t)})},initMetaboxToggle:function(e,i){var t=e.parent();i.preventDefault(),l(i.target).filter(":input, option, .sort").length||(t.hasClass("closed")?t.removeClass("closed"):t.addClass("closed"),e.next(".simpay-metabox-content").stop().slideToggle())},loadCustomFieldMetaboxes:function(){var t=d.find(".simpay-custom-fields"),e=t.find(".simpay-field-metabox").get();e.sort(function(e,i){var t=parseInt(l(e).attr("rel"),10),a=parseInt(l(i).attr("rel"),10);return t<a?-1:a<t?1:0}),l(e).each(function(e,i){t.append(i)}),l(".simpay-metabox.closed").each(function(){l(this).find(".simpay-metabox-content").hide()})},addDatepicker:function(){var e=l(".simpay-date-input");e.datepicker(),e.datepicker("option","dateFormat",spGeneral.strings.dateFormat)},toggleAmountOptions:function(e){var i="",t="",a=e.val(),s=d.find(".simpay-panel-field #_amount_type"),o=s.find('input[type="radio"]'),n=s.find('input[type="radio"]:checked');e.is(":radio")?(i=e.data("disable-amount-check"),t=e.data("disable-amount-single"),void 0!==i&&i!==a||void 0!==t&&t===a?(spAdminPro.setDisabledRadios(o,!0),d.find(".toggle-_amount_type-one_time_set, .toggle-_amount_type-one_time_custom").hide()):(spAdminPro.setDisabledRadios(o,!1),d.find(".toggle-_amount_type-"+n.val()).show())):e.is(":checkbox")&&(e.is(":checked")?(spAdminPro.setDisabledRadios(o,!0),d.find(".toggle-_amount_type-one_time_set, .toggle-_amount_type-one_time_custom").hide()):(spAdminPro.setDisabledRadios(o,!1),d.find(".toggle-_amount_type-"+n.val()).show()))},setDisabledRadios:function(e,i){e.each(function(){i?l(this).attr("disabled","disabled"):l(this).removeAttr("disabled")})}},l(document).ready(function(e){spAdminPro.init()})}(jQuery);
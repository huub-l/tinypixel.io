/*! WP Simple Pay Pro 3 - 3.2.3
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2018
 * Licensed GPLv2+ */

var spSubAdmin={};!function(e){"use strict";var t,l;spSubAdmin={init:function(){t=e(document.body),l=t.find("#subscription-options-settings-panel"),this.loadMultiPlanSubscriptions(),this.initSortablePlans(l.find(".simpay-multi-subscriptions tbody")),l.find(".simpay-add-plan").on("click.simpayAddPlan",function(i){i.preventDefault(),spSubAdmin.addPlan(i)}),l.find(".simpay-panel-field").on("click.simpayRemovePlan",".simpay-remove-plan",function(i){spSubAdmin.removePlan(e(this),i)}),l.find(".simpay-multi-subscriptions").on("click.simpayUpdateDefaultPlan",'.simpay-multi-plan-default input[type="radio"]',function(i){spSubAdmin.updateDefaultPlan(e(this))}),l.find(".simpay-multi-subscriptions").on("change.simpayUpdatePlanSelect",".simpay-multi-plan-select",function(i){spSubAdmin.updatePlanSelect(e(this))}),l.find("#_subscription_custom_amount").find('input[type="radio"]').on("change.simpayToggleSubscription",function(i){spSubAdmin.togglePlans(e(this))}),""===l.find("#simpay-multi-plan-default-value").val()&&l.find('.simpay-multi-plan-default input[type="radio"]:first').trigger("click.simpayUpdateDefaultPlan")},initSortablePlans:function(i){i.sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort-handle",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(i,n){spSubAdmin.orderPlans()}})},loadMultiPlanSubscriptions:function(){var i=l.find(".simpay-multi-sub").get();i.sort(function(i,n){var a=parseInt(e(i).attr("rel"),10),t=parseInt(e(n).attr("rel"),10);return a<t?-1:t<a?1:0}),l.find(i).each(function(i,n){l.find(".simpay-multi-subscriptions tbody").append(n)})},togglePlans:function(i){"enabled"===i.val()&&i.is(":checked")?t.find("#_single_plan").attr("disabled","disabled").trigger("chosen:updated"):t.find("#_single_plan").removeAttr("disabled").trigger("chosen:updated")},updatePlanSelect:function(i){var n=i.parent().data("field-key");l.find("#simpay-subscription-multi-plan-default-"+n+"-yes").is(":checked")&&l.find("#simpay-multi-plan-default-value").val(i.find("option:selected").val())},updateDefaultPlan:function(i){var n=i.closest(".simpay-multi-plan-default").parent().find(".simpay-multi-plan-select").find("option:selected").val();l.find("#simpay-multi-plan-default-value").val(n)},orderPlans:function(){l.find(".simpay-multi-sub").each(function(i,n){var a=parseInt(e(n).index(".simpay-multi-sub"));l.find(".plan-order",n).val(a)})},addPlan:function(i){var n=l.find(".simpay-multi-subscriptions tbody"),a={action:"simpay_add_plan",counter:parseInt(l.find(".simpay-multi-sub:last").data("field-key"))+1,addPlanNonce:t.find("#simpay_add_plan_nonce").val()};i.preventDefault(),e.ajax({url:ajaxurl,method:"POST",data:a,success:function(i){n.append(i),n.find("select").chosen()},error:function(i){spShared.debugLog(i)}})},removePlan:function(i,n){n.preventDefault(),i.closest(".simpay-multi-sub").remove()}},e(document).ready(function(i){spSubAdmin.init()})}(jQuery);